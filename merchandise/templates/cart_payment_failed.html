{% extends 'base.html' %}
{% load humanize %}
{% block title %}Pembayaran Gagal{% endblock %}

{% block content %}
<div class="container" style="margin-top:40px; max-width:900px;">
    <div class="card" style="padding:24px;">
        <h1 class="h3" style="margin-bottom:8px;">Pembayaran gagal</h1>
        <p class="body" style="margin-bottom:12px;">
            Oops - ada pembayaranmu gagal.
        </p>
        <div class="card" style="background:#fff7f7; border-left:4px solid var(--pacil-red-base); padding:12px; margin-bottom:16px;">
            <p class="body" style="margin:0; color:var(--pacil-red-base);"><strong>{{ error }}</strong></p>
        </div>
        
        {% if failed_items %}
        <div style="margin-bottom:12px;">
            <h2 class="h6" style="margin:0 0 8px 0;">Merchandise yang bermasalah</h2>
            <ul style="margin-top:8px;">
                {% for item in failed_items %}
                <li class="body" style="margin-bottom:6px;">
                    {{ item.merchandise.name }} - dipesan: {{ item.quantity }}, tersedia: {{ item.merchandise.stock }}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <div style="display:flex; gap:10px; align-items:center; margin-top:16px;">
            <form method="post" action="{% url 'merchandise:cart_pay' cart.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">Coba lagi</button>
            </form>
            <a href="{% url 'merchandise:merchandise_list' %}" class="btn btn-outline">Lanjut belanja</a>
            <a href="{% url 'merchandise:cart_detail' %}" class="btn btn-outline">Lihat keranjang</a>
        </div>
    </div>
    
    {% if cart and cart.items.all %}
    <aside style="margin-top:20px;">
        <h3 class="h6">Rangkuman pesanan</h3>
        <div class="card" style="padding:12px; margin-top:8px;">
            <ul style="list-style:none; padding:0; margin:0;">
                {% for item in cart.items.all %}
                <li style="display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid var(--neutral-100);">
                    <span class="body">{{ item.merchandise.name }} x {{ item.quantity }}</span>
                    <strong class="body">Rp {{ item.subtotal|intcomma }}</strong>
                </li>
                {% endfor %}
            </ul>
            <div style="display:flex; justify-content:space-between; margin-top:12px;">
                <span class="body">Subtotal</span>
                <strong class="body">Rp {{ cart.total_price|intcomma }}</strong>
            </div>
        </div>
    </aside>
    {% endif %}
</div>
{% endblock %}
