{% extends 'base.html' %}
{% load humanize %}
{% block title %}Merchandise{% endblock %}
 
{% block content %}
<div class="container mt-2">
    <div class="flex justify-between items-center mb-6">
        <h1 class="h3">Daftar Merchandise</h1>
        {% if user.is_authenticated and user.role == 'user' %}
        <a href="{% url 'merchandise:cart_detail' %}" class="btn btn-primary">Keranjang</a>
        {% endif %}
        {% if user.is_authenticated and user.role == 'organizer' %}
        <a href="{% url 'merchandise:merchandise_create' %}" class="btn btn-primary">+ Tambah Produk</a>
        {% endif %}
    </div>

    {% if merchandises %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" style="margin-top: 1rem;">
        {% for merchandise in merchandises %}
        <div class="card merchandise-card flex flex-col" style="margin:0; display:flex; flex-direction:column; overflow:hidden; border-radius:12px; background:white;">
            {% if merchandise.image_url %}
            <img src="{{ merchandise.image_url }}" alt="{{ merchandise.name }}" loading="lazy" style="width:100%; height:200px; object-fit:contain; object-position:left; border-radius:12px 12px 0 0;">
            {% else %}
            <div style="background-color:var(--neutral-100); height:200px; display:flex; align-items:center; justify-content:center;">
                <span class="footnote">No Image</span>
            </div>
            {% endif %}

            <div style="padding:16px;">
                <h3 class="h4" style="margin-bottom:8px;">{{ merchandise.name }}</h3>
                <p class="body" style="margin-bottom:4px;">Rp {{ merchandise.price|intcomma }}</p>
                <p class="footnote" style="margin-bottom:4px;">Stock: {{ merchandise.stock }}</p>
                <p class="footnot" style="color:var(--neutral-500);">Category: {{ merchandise.category }}</p>
            </div>

            <div style="padding:0 16px 16px 16px;">
                <a href="{% url 'merchandise:merchandise_detail' merchandise.id %}" class="btn btn-outline w-full" style="margin-bottom: 8px;">Detail</a>
                {% if user.is_authenticated and user.role == 'user' %}
                {% if merchandise.stock > 0 %}
                <form method="post" action="{% url 'merchandise:cart_add_item' merchandise.id %}" style="margin-bottom: 8px;">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="1"> 
                    <button type="submit" class="btn btn-primary w-full">Tambah ke Keranjang</button>
                </form>
                {% else %}
                <button type="button" class="btn btn-secondary w-full" disabled style="cursor: default; opacity: 0.6;">Stok Habis</button>
                {% endif %}
                {% endif %}
                {% if user.is_authenticated and user == merchandise.organizer %}
                <div class="flex gap-2 mt-2">
                    <a href="{% url 'merchandise:merchandise_update' merchandise.id %}" class="btn btn-primary flex-1">Edit</a>
                    <a href="{% url 'merchandise:merchandise_delete' merchandise.id %}" class="btn btn-danger flex-1">Delete</a>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <p class="body">Belum ada merchandise yang tersedia.</p>
    </div>
    {% endif %}
</div>

<style>
.container > .grid {
    display: grid;
    gap: 1rem;
}

@media (min-width: 768px) { 
    .grid.md\:grid-cols-2 {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024px) { 
    .grid.lg\:grid-cols-3 {
        grid-template-columns: repeat(3, 1fr);
    }
}

.card {
    margin: 0;
    display: block;
}

.merchandise-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    transition: all 0.25s ease;
}

</style>
{% endblock %}